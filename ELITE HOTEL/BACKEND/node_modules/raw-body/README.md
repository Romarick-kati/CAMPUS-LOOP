# raw-body[![NPM Version][npm-image]][npm-url][![NPM Downloads][downloads-image]][downloads-url][![Node.js Version][node-version-image]][node-version-url][![Build status][github-actions-ci-image]][github-actions-ci-url][![Test coverage][coveralls-image]][coveralls-url]Gets the entire buffer of a stream either as a `Buffer` or a string.Validates the stream's length against an expected length and maximum limit.Ideal for parsing request bodies.## InstallThis is a [Node.js](https://nodejs.org/en/) module available through the[npm registry](https://www.npmjs.com/). Installation is done using the[`npm install` command](https://docs.npmjs.com/getting-started/installing-npm-packages-locally):```sh$ npm install raw-body```### TypeScriptThis module includes a [TypeScript](https://www.typescriptlang.org/)declaration file to enable auto complete in compatible editors and typeinformation for TypeScript projects. This module depends on the Node.jstypes, so install `@types/node`:```sh$ npm install @types/node```## API```jsvar getRawBody = require('raw-body')```### getRawBody(stream, [options], [callback])**Returns a promise if no callback specified and global `Promise` exists.**Options:- `length` - The length of the stream.  If the contents of the stream do not add up to this length,  an `400` error code is returned.- `limit` - The byte limit of the body.  This is the number of bytes or any string format supported by  [bytes](https://www.npmjs.com/package/bytes),  for example `1000`, `'500kb'` or `'3mb'`.  If the body ends up being larger than this limit,  a `413` error code is returned.- `encoding` - The encoding to use to decode the body into a string.  By default, a `Buffer` instance will be returned when no encoding is specified.  Most likely, you want `utf-8`, so setting `encoding` to `true` will decode as `utf-8`.  You can use any type of encoding supported by [iconv-lite](https://www.npmjs.org/package/iconv-lite#readme).You can also pass a string in place of options to just specify the encoding.If an error occurs, the stream will be paused, everything unpiped,and you are responsible for correctly disposing the stream.For HTTP requests, you may need to finish consuming the stream ifyou want to keep the socket open for future requests. For streamsthat use file descriptors, you should `stream.destroy()` or`stream.close()` to prevent leaks.## ErrorsThis module creates errors depending on the error condition during reading.The error may be an error from the underlying Node.js implementation, but isotherwise an error created by this module, which has the following attributes:  * `limit` - the limit in bytes  * `length` and `expected` - the expected length of the stream  * `received` - the received bytes  * `encoding` - the invalid encoding  * `status` and `statusCode` - the corresponding status code for the error  * `type` - the error type### TypesThe errors from this module have a `type` property which allows for the programmaticdetermination of the type of error returned.#### encoding.unsupportedThis error will occur when the `encoding` option is specified, but the value doesnot map to an encoding supported by the [iconv-lite](https://www.npmjs.org/package/iconv-lite#readme)module.#### entity.too.largeThis error will occur when the `limit` option is specified, but the stream hasan entity that is larger.#### request.abortedThis error will occur when the request stream is aborted by the client beforereading the body has finished.#### request.size.invalidThis error will occur when the `length` option is specified, but the stream hasemitted more bytes.#### stream.encoding.setThis error will occur when the given stream has an encoding set on it, making ita decoded stream. The stream should not have an encoding set and is expected toemit `Buffer` objects.#### stream.not.readableThis error will occur when the given stream is not readable.## Examples### Simple Express example```jsvar contentType = require('content-type')var express = require('express')var getRawBody = require('raw-body')var app = express()app.use(function (req, res, next) {  getRawBody(req, {    length: req.headers['content-length'],    limit: '1mb',    encoding: contentType.parse(req).parameters.charset  }, function (err, string) {    if (err) return next(err)    req.text = string    next()  })})// now access req.text```### Simple Koa example```jsvar contentType = require('content-type')var getRawBody = require('raw-body')var koa = require('koa')var app = koa()app.use(function * (next) {  this.text = yield getRawBody(this.req, {    length: this.req.headers['content-length'],    limit: '1mb',    encoding: contentType.parse(this.req).parameters.charset  })  yield next})// now access this.text```### Using as a promiseTo use this library as a promise, simply omit the `callback` and a promise isreturned, provided that a global `Promise` is defined.```jsvar getRawBody = require('raw-body')var http = require('http')var server = http.createServer(function (req, res) {  getRawBody(req)    .then(function (buf) {      res.statusCode = 200      res.end(buf.length + ' bytes submitted')    })    .catch(function (err) {      res.statusCode = 500      res.end(err.message)    })})server.listen(3000)```### Using with TypeScript```tsimport * as getRawBody from 'raw-body';import * as http from 'http';const server = http.createServer((req, res) => {  getRawBody(req)  .then((buf) => {    res.statusCode = 200;    res.end(buf.length + ' bytes submitted');  })  .catch((err) => {    res.statusCode = err.statusCode;    res.end(err.message);  });});server.listen(3000);```## License[MIT](LICENSE)[npm-image]: https://img.shields.io/npm/v/raw-body.svg[npm-url]: https://npmjs.org/package/raw-body[node-version-image]: https://img.shields.io/node/v/raw-body.svg[node-version-url]: https://nodejs.org/en/download/[coveralls-image]: https://img.shields.io/coveralls/stream-utils/raw-body/master.svg[coveralls-url]: https://coveralls.io/r/stream-utils/raw-body?branch=master[downloads-image]: https://img.shields.io/npm/dm/raw-body.svg[downloads-url]: https://npmjs.org/package/raw-body[github-actions-ci-image]: https://img.shields.io/github/actions/workflow/status/stream-utils/raw-body/ci.yml?branch=master&label=ci[github-actions-ci-url]: https://github.com/jshttp/stream-utils/raw-body?query=workflow%3Aci